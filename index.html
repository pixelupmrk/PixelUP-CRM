<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0ea5e9" />
  <title>CRM PixelUp — Bot integrado</title>

  <!-- Tailwind via CDN (sem build) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Estilos mínimos do widget -->
  <style>
    :root { --px-blue: #00b2ff; }
    .glow { box-shadow: 0 0 18px rgba(0,178,255,.6); }
    .neon { text-shadow: 0 0 12px rgba(0,178,255,.8); }
    .scroll-smooth { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100 scroll-smooth">
  <!-- Header -->
  <header class="border-b border-neutral-800/70 bg-neutral-900/40 backdrop-blur">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-3 h-6 rounded-full bg-cyan-400 glow"></div>
        <h1 class="text-lg sm:text-xl font-semibold neon">
          CRM PixelUp
        </h1>
      </div>
      <nav class="text-sm text-neutral-300">
        <a href="#kanban" class="hover:text-white">Kanban</a>
        <span class="mx-2 opacity-30">•</span>
        <a href="#bot" class="hover:text-white">Bot</a>
      </nav>
    </div>
  </header>

  <!-- Conteúdo principal (placeholder Kanban/CRM para você ligar seu app) -->
  <main id="kanban" class="max-w-6xl mx-auto px-4 py-10">
    <section class="mb-10">
      <h2 class="text-xl font-semibold mb-2">Seu CRM / Kanban</h2>
      <p class="text-neutral-300">
        Esta é uma página estática pronta para deploy. Conecte aqui seus componentes do Kanban/CRM.
      </p>
    </section>

    <section id="bot" class="mt-8">
      <h2 class="text-xl font-semibold mb-3">Widget do Bot</h2>
      <p class="text-neutral-300 mb-4">
        O botão flutuante no canto inferior direito abre o chat. Toda mensagem enviada chama sua API não-oficial.
      </p>
    </section>
  </main>

  <!-- Botão flutuante (launcher) -->
  <button id="bot-launcher"
          class="fixed bottom-5 right-5 z-40 rounded-full px-4 py-3 bg-cyan-500 text-black font-semibold glow hover:bg-cyan-400 active:scale-95 transition"
          aria-label="Abrir chat do bot">
    Abrir Chat
  </button>

  <!-- Widget do Bot -->
  <div id="bot-widget"
       class="fixed bottom-24 right-5 z-40 w-[min(92vw,380px)] max-h-[70vh] bg-neutral-900 border border-neutral-800 rounded-2xl overflow-hidden hidden">
    <!-- Cabeçalho do widget -->
    <div class="flex items-center justify-between px-4 py-3 border-b border-neutral-800 bg-neutral-900/70">
      <div class="flex items-center gap-2">
        <div class="w-2.5 h-5 rounded-full bg-cyan-400 glow"></div>
        <span class="font-medium">PixelUp • Bot</span>
      </div>
      <button id="bot-close" class="text-neutral-400 hover:text-white">
        ✕
      </button>
    </div>

    <!-- Corpo do chat -->
    <div id="chat-log" class="p-3 space-y-3 overflow-y-auto" style="max-height: 50vh;">
      <!-- Mensagens aparecem aqui -->
      <div class="text-xs text-neutral-400">
        Dica: digite qualquer mensagem para acionar a API.
      </div>
    </div>

    <!-- Input -->
    <form id="chat-form" class="p-3 border-t border-neutral-800 bg-neutral-900/70">
      <div class="flex items-center gap-2">
        <input id="chat-input" type="text" placeholder="Escreva sua mensagem..."
               class="flex-1 bg-neutral-800/80 border border-neutral-700 rounded-lg px-3 py-2 outline-none focus:border-cyan-500"
               required />
        <button type="submit"
                class="bg-cyan-500 text-black font-semibold px-3 py-2 rounded-lg hover:bg-cyan-400 active:scale-95 transition">
          Enviar
        </button>
      </div>
    </form>
  </div>

  <!-- Configuração da sua API (edite aqui) -->
  <script>
    // === CONFIG: ajuste estes valores para sua API não-oficial ===
    // IMPORTANTE: em site estático, chaves expostas no front ficam públicas.
    // O ideal é usar um backend/proxy seu para esconder segredos.
    window.PIXELUP_BOT_CONFIG = {
      API_URL: "https://SEU-ENDPOINT-AQUI.exemplo/api/messages", // <- troque para seu endpoint
      API_TOKEN: "", // se precisar enviar token no header
      // Se você já tem um arquivo local do bot (ex.: /wa-bot/wa-bot.js), mantenha o caminho abaixo.
      WA_BOT_SCRIPT: "/wa-bot/wa-bot.js" // opcional; carregamos de forma 100% dinâmica
    };
  </script>

  <!-- Lógica do widget + chamada da API -->
  <script>
    (function () {
      const cfg = window.PIXELUP_BOT_CONFIG || {};
      const widget = document.getElementById("bot-widget");
      const openBtn = document.getElementById("bot-launcher");
      const closeBtn = document.getElementById("bot-close");
      const form = document.getElementById("chat-form");
      const input = document.getElementById("chat-input");
      const log = document.getElementById("chat-log");

      // Abre/fecha
      openBtn.addEventListener("click", () => widget.classList.toggle("hidden"));
      closeBtn.addEventListener("click", () => widget.classList.add("hidden"));

      // Utilitário: render de mensagem
      function appendMsg(text, role = "user") {
        const wrap = document.createElement("div");
        wrap.className = "flex";
        wrap.innerHTML = role === "user"
          ? `<div class="ml-auto max-w-[85%] bg-cyan-500 text-black rounded-xl px-3 py-2">${escapeHtml(text)}</div>`
          : `<div class="max-w-[85%] bg-neutral-800 text-neutral-100 rounded-xl px-3 py-2 border border-neutral-700">${escapeHtml(text)}</div>`;
        log.appendChild(wrap);
        log.scrollTop = log.scrollHeight;
      }

      function escapeHtml(s) {
        return s.replace(/[&<>"']/g, m => ({
          "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
        }[m]));
      }

      // Chama sua API em QUALQUER mensagem enviada
      async function callApi(message) {
        if (!cfg.API_URL) {
          appendMsg("⚠️ API_URL não configurada. Edite no index.html.", "bot");
          return;
        }
        try {
          const headers = { "Content-Type": "application/json" };
          if (cfg.API_TOKEN) headers["Authorization"] = `Bearer ${cfg.API_TOKEN}`;

          const res = await fetch(cfg.API_URL, {
            method: "POST",
            headers,
            body: JSON.stringify({
              message,
              source: "pixelup-web",
              page: location.href,
              ts: Date.now()
            })
          });

          if (!res.ok) {
            const t = await res.text();
            appendMsg(`Erro da API (${res.status}): ${t || "sem detalhes"}`, "bot");
            return;
          }

          const data = await res.json().catch(() => ({}));
          const reply = (data && (data.reply || data.message || data.text)) || "✅ Mensagem enviada à API.";
          appendMsg(String(reply), "bot");
        } catch (e) {
          appendMsg(`Erro de rede: ${e.message}`, "bot");
        }
      }

      // Envio do formulário
      form.addEventListener("submit", (ev) => {
        ev.preventDefault();
        const text = (input.value || "").trim();
        if (!text) return;
        appendMsg(text, "user");
        input.value = "";
        callApi(text); // aciona a API para qualquer mensagem
      });

      // Carregamento opcional do script do wa-bot (APENAS UM MÉTODO DE CADA VEZ!)
      // Mantemos UM método dinâmico. Não adicione também <script src="/wa-bot/wa-bot.js"> no HTML.
      if (cfg.WA_BOT_SCRIPT) {
        const s = document.createElement("script");
        s.src = cfg.WA_BOT_SCRIPT;
        s.defer = true;
        s.onload = () => console.log("[wa-bot] carregado.");
        s.onerror = () => console.log("[wa-bot] não encontrado (ok se você não usa esse arquivo).");
        document.body.appendChild(s);
      }
    })();
  </script>

  <!-- Boa prática: noscript -->
  <noscript>
    <div class="fixed inset-0 bg-neutral-900 text-white p-6">
      Habilite o JavaScript para usar o chat/bot.
    </div>
  </noscript>
</body>
</html>
